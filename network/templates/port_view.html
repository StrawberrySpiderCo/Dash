{% extends 'base.html' %}
{% load static %}
{% block title %}Network{% endblock %}
{% block template %}
<h2>Port View</h2>

<form id="editForm" action="{% url 'edit_ports' %}" method="post">
  {% csrf_token %}
  <input type="hidden" name="selected_ports" id="selectedPorts">
  <input type="button" value="Edit Selected" onclick="openPopup()">
</form>

<div id="popup" style="display: none;">
  <h2>Additional Information</h2>
  <!-- Additional fields for user input -->
  <input type="text" name="additional_field" id="additionalField" placeholder="Enter additional information">
  <button onclick="submitForm()">Submit</button>
</div>

<table>
  <thead>
    <tr>
      <th>
        <input type="checkbox" id="selectAllCheckbox">
        <label for="selectAllCheckbox" onclick="toggleSelectAll()"> 
        Select/Deselect All
      </label>
      </th>
      <th>Description</th>
      <th>MAC Address</th>
      <th>MTU</th>
      <th>Bandwidth</th>
      <th>Media Type</th>
      <th>Duplex</th>
      <th>Line Protocol</th>
      <th>Operational Status</th>
      <th>Interface Type</th>
      <th>IPv4 Address</th>
      <th>IPv4 Subnet</th>
    </tr>
  </thead>
  <tbody>
    {% for interface in device_interfaces %}
    <tr>
      <td><input type="checkbox" id="port{{ interface.id }}" name="port" value="{{ interface.id }}" onchange="updateSelectedPorts()">
          <label for="port{{ interface.id }}">{{ interface.name }}</label></td>
      <td>{{ interface.description }}</td>
      <td>{{ interface.mac_address }}</td>
      <td>{{ interface.mtu }}</td>
      <td>{{ interface.bandwidth }}</td>
      <td>{{ interface.media_type }}</td>
      <td>{{ interface.duplex }}</td>
      <td>{{ interface.line_protocol }}</td>
      <td>{{ interface.oper_status }}</td>
      <td>{{ interface.interface_type }}</td>
      <td>{{ interface.ipv4_address }}</td>
      <td>{{ interface.ipv4_subnet }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  function openPopup() {
    document.getElementById('popup').style.display = 'block';
  }

  function toggleSelectAll() {
    var checkboxes = document.querySelectorAll('input[name="port"]');
    checkboxes.forEach(function(checkbox) {
      checkbox.checked = !checkbox.checked;
    });
    updateSelectedPorts();
  }

  function updateSelectedPorts() {
    var selectedPorts = [];
    var checkboxes = document.querySelectorAll('input[name="port"]:checked');
    checkboxes.forEach(function(checkbox) {
      selectedPorts.push(checkbox.value);
    });
    document.getElementById('selectedPorts').value = JSON.stringify(selectedPorts);
  }

  function submitForm() {
    // Get the value from the additional field
    var additionalData = document.getElementById('additionalField').value;

    // Set the value to a hidden input field in the form
    document.getElementById('selectedPorts').value = additionalData;

    // Submit the form
    document.getElementById('editForm').submit();
  }
</script>

{% endblock %}
